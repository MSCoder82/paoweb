<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>USACE NWW • R-PIE Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --brand-yellow:#ffd530;
      --brand-red:#EF3340;
      --brand-black:#030000;
      --ink:#0f1220;
      --muted:#6b7280;
      --card:#ffffff;
      --ok:#16a34a;
      --warn:#d97706;
      --err:#b91c1c;
      --radius:14px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(255,213,48,.55), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(239,51,64,.35), transparent 60%),
        linear-gradient(180deg, #fafafa 0%, #f3f4f6 100%);
    }
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px;}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px;}
    .brand{display:flex;gap:12px;align-items:center;}
    .badge{
      background:linear-gradient(135deg, var(--brand-yellow), var(--brand-red));
      color:var(--brand-black);
      padding:10px 14px;border-radius:999px;font-weight:700;letter-spacing:.25px;box-shadow:0 6px 18px rgba(0,0,0,.1);
    }
    .tabs{display:flex;gap:8px;flex-wrap:wrap;}
    .tab{
      background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:10px 14px;cursor:pointer;
      box-shadow:0 4px 16px rgba(0,0,0,.06);
    }
    .tab.active{border-color:var(--brand-red);outline:2px solid rgba(239,51,64,.15)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start;}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{
      background:rgba(255,255,255,.85);backdrop-filter: blur(8px);
      border:1px solid #e5e7eb;border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(0,0,0,.08);padding:18px;
    }
    h1{font-size:22px;margin:0;color:var(--brand-black)}
    h2{font-size:18px;margin:0 0 12px}
    h3{font-size:16px;margin:18px 0 8px}
    .help{color:var(--muted);font-size:13px}
    label{display:block;font-weight:600;margin:12px 0 6px}
    input, textarea{
      width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;font-size:14px;
    }
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .btnbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700;
      transition:transform .02s ease;box-shadow:0 8px 20px rgba(0,0,0,.08);
      background:linear-gradient(135deg, var(--brand-red), var(--brand-yellow));color:#111;
    }
    .btn.alt{background:#111;color:#fff}
    .btn.ghost{background:#fff;color:#111;border:1px solid #e5e7eb}
    .btn:active{transform:translateY(1px)}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    details{border:1px dashed #e5e7eb;border-radius:12px;background:#fff;margin:10px 0;padding:8px 10px;}
    summary{cursor:pointer;font-weight:700}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #e5e7eb;padding:8px 10px;font-size:14px}
    th{background:#fafafa;text-align:left}
    .output{
      white-space:pre-wrap;background:#0b1020;color:#f1f5f9;padding:16px;border-radius:12px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:13px;min-height:220px;
    }
    .notice{
      background:linear-gradient(135deg, rgba(255,213,48,.2), rgba(239,51,64,.2));
      border:1px solid rgba(0,0,0,.06);border-radius:12px;padding:10px 12px;font-size:14px
    }
    /* Tag checklists */
    .taglist{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .taglist label{
      display:inline-flex;align-items:center;gap:6px;border:1px solid #e5e7eb;border-radius:999px;
      padding:6px 10px;background:#fff;font-size:13px;cursor:pointer;user-select:none;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
    }
    .taglist input[type="checkbox"]{appearance:none;width:14px;height:14px;border:1px solid #cbd5e1;border-radius:3px}
    .taglist input[type="checkbox"]:checked{background:linear-gradient(135deg, var(--brand-red), var(--brand-yellow));border-color:#111}
    .tagadd{display:flex;gap:8px;margin-top:8px}
    .tagadd input{flex:1}
    .footer-note{font-size:12px;color:var(--muted);margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge">USACE • NWW</div>
        <div>
          <h1>R-PIE Communication Plan Builder</h1>
          <div class="help">Staff and Admin views. Local saves. OpenAI-powered plan drafting.</div>
        </div>
      </div>
      <div class="tabs" role="tablist" aria-label="Role selector">
        <button id="tab-staff" class="tab active" role="tab" aria-selected="true">Staff view</button>
        <button id="tab-admin" class="tab" role="tab" aria-selected="false">Admin view</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: INPUTS -->
      <section class="card" id="panel-inputs" aria-labelledby="tab-staff">
        <h2>Plan inputs</h2>
        <div class="notice">Complete the steps, select from curated menus, then generate a draft. Save private drafts anytime.</div>

        <details open>
          <summary>Connection</summary>
          <label for="apiKey">OpenAI API key</label>
          <input id="apiKey" type="password" placeholder="sk-..." autocomplete="off" />
          <div class="row">
            <div>
              <label for="model">Model</label>
              <input id="model" value="gpt-4.1-mini" />
            </div>
            <div>
              <label for="temperature">Temperature</label>
              <input id="temperature" type="number" step="0.1" min="0" max="2" value="0.2" />
            </div>
          </div>
          <label for="policy">Admin guidance to include in prompt (optional)</label>
          <textarea id="policy" placeholder="Tone, style, sensitivities, risk items, do-not-mentions..."></textarea>
        </details>

        <div id="stepper" class="tabs" role="tablist" aria-label="Plan steps">
          <button type="button" class="tab" role="tab" aria-selected="true" data-step="1">Step 1</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="2">Step 2</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="3">Step 3</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="4">Step 4</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="5">Step 5</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="6">Step 6</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="7">Step 7</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="8">Step 8</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="9">Step 9</button>
          <button type="button" class="tab" role="tab" aria-selected="false" data-step="10">Step 10</button>
        </div>
        <div id="progress" class="help" aria-live="polite"></div>

        <div class="step-pane" id="step1" role="tabpanel">
          <h3>Step 1 — Identify communication requirements</h3>
          <label for="issue">Issue statement</label>
          <textarea id="issue" placeholder="Define the issue, scope, and required support."></textarea>
          <label for="requirements">Requirements</label>
          <textarea id="requirements" placeholder="Key products, approvals, timing, authorities."></textarea>
        </div>

        <div class="step-pane" id="step2" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 2 — Analyze the current situation</h3>
          <label for="situation">Situation analysis</label>
          <textarea id="situation" placeholder="Context, constraints, opportunities."></textarea>
          <div class="row">
            <div><label for="swotS">Strengths</label><textarea id="swotS"></textarea></div>
            <div><label for="swotW">Weaknesses</label><textarea id="swotW"></textarea></div>
          </div>
          <div class="row">
            <div><label for="swotO">Opportunities</label><textarea id="swotO"></textarea></div>
            <div><label for="swotT">Threats</label><textarea id="swotT"></textarea></div>
          </div>
        </div>

        <div class="step-pane" id="step3" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 3 — Stakeholders and target audiences</h3>
          <label>Business lines</label>
          <div id="businessLinesList" class="taglist"></div>
          <div class="tagadd">
            <input id="businessLinesAdd" placeholder="Add custom business line" />
            <button class="btn ghost" data-add="businessLines">Add</button>
          </div>

          <label style="margin-top:10px">Lines of effort</label>
          <div id="loeList" class="taglist"></div>
          <div class="tagadd">
            <input id="loeAdd" placeholder="Add custom line of effort" />
            <button class="btn ghost" data-add="loe">Add</button>
          </div>

          <label style="margin-top:10px">Target audiences</label>
          <div id="audiencesList" class="taglist"></div>
          <div class="tagadd">
            <input id="audiencesAdd" placeholder="Add custom audience" />
            <button class="btn ghost" data-add="audiences">Add</button>
          </div>

          <label style="margin-top:10px">Stakeholders</label>
          <div id="stakeholdersList" class="taglist"></div>
          <div class="tagadd">
            <input id="stakeholdersAdd" placeholder="Add custom stakeholder" />
            <button class="btn ghost" data-add="stakeholders">Add</button>
          </div>

          <label for="audienceNotes" style="margin-top:10px">Notes (audience priorities, sensitivities)</label>
          <textarea id="audienceNotes"></textarea>
        </div>

        <div class="step-pane" id="step4" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 4 — Goals and SMART objectives</h3>
          <label for="goals">Goals</label>
          <textarea id="goals" placeholder="Desired end state, long term focus."></textarea>
          <label for="objectives">SMART objectives</label>
          <textarea id="objectives" placeholder="Specific, Measurable, Achievable, Relevant, Time-bound."></textarea>
        </div>

        <div class="step-pane" id="step5" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 5 — Strategies, tactics, key messages, talking points</h3>
          <label for="strategies">Strategies</label>
          <textarea id="strategies" placeholder="How to reach goals and objectives."></textarea>
          <label for="tactics">Tactics</label>
          <textarea id="tactics" placeholder="Products, services, activities."></textarea>
          <label for="messages">Key messages</label>
          <textarea id="messages" placeholder="27-9-3 structure encouraged."></textarea>
          <label for="talking">Talking points</label>
          <textarea id="talking"></textarea>
        </div>

        <div class="step-pane" id="step6" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 6 — Budget</h3>
          <div class="row">
            <div><label for="labor">Labor</label><input id="labor" type="text" placeholder="$ or hours"/></div>
            <div><label for="materials">Materials</label><input id="materials" type="text" placeholder="$"/></div>
          </div>
          <div class="row">
            <div><label for="postage">Postage</label><input id="postage" type="text" placeholder="$"/></div>
            <div><label for="contract">Contractor/Facilitator</label><input id="contract" type="text" placeholder="$"/></div>
          </div>
          <label for="av">AV/Other</label><input id="av" type="text" placeholder="$ or notes"/>
        </div>

        <div class="step-pane" id="step7" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 7 — Action matrix</h3>
          <div class="help">Add rows, then include dates, actions, roles, and methods.</div>
          <table id="am-table">
            <thead><tr><th>Date</th><th>Action</th><th>Responsibility</th><th>When</th><th>Method</th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="btnbar">
            <button class="btn ghost" id="am-add">+ Add row</button>
            <button class="btn ghost" id="am-clear">Clear</button>
          </div>
        </div>

        <div class="step-pane" id="step8" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 8 — Implementation tracking</h3>
          <label for="tracking">Tracking notes</label>
          <textarea id="tracking" placeholder="Cadence, ownership, dashboards."></textarea>
        </div>

        <div class="step-pane" id="step9" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 9 — Measurement plan</h3>
          <label>Outputs (products/channels)</label>
          <div id="outputsList" class="taglist"></div>
          <div class="tagadd">
            <input id="outputsAdd" placeholder="Add custom output" />
            <button class="btn ghost" data-add="outputs">Add</button>
          </div>

          <label style="margin-top:10px">Outtakes (exposure/engagement)</label>
          <div id="outtakesList" class="taglist"></div>
          <div class="tagadd">
            <input id="outtakesAdd" placeholder="Add custom outtake" />
            <button class="btn ghost" data-add="outtakes">Add</button>
          </div>

          <label style="margin-top:10px">Outcomes (impact/behavior)</label>
          <div id="outcomesList" class="taglist"></div>
          <div class="tagadd">
            <input id="outcomesAdd" placeholder="Add custom outcome" />
            <button class="btn ghost" data-add="outcomes">Add</button>
          </div>

          <label for="measurementNotes" style="margin-top:10px">Measurement notes</label>
          <textarea id="measurementNotes" placeholder="Baselines, targets, data sources, cadence."></textarea>
        </div>

        <div class="step-pane" id="step10" role="tabpanel" hidden aria-hidden="true">
          <h3>Step 10 — Evaluation and feedback</h3>
          <label for="evaluation">Evaluation plan</label>
          <textarea id="evaluation" placeholder="Methods, timing, follow-on research and updates."></textarea>
        </div>

        <div class="btnbar">
          <button class="btn" id="generate">Generate plan</button>
          <button class="btn alt" id="save">Save draft</button>
          <button class="btn ghost" id="load">Load draft</button>
          <button class="btn ghost" id="exportMd">Export Markdown</button>
          <button class="btn ghost" id="exportJson">Export JSON</button>
          <button class="btn ghost" id="clear">Clear form</button>
        </div>
      </section>

      <!-- RIGHT: OUTPUT + ADMIN -->
      <section class="card" id="panel-output">
        <h2>Draft output</h2>
        <div id="status" class="help">Ready.</div>
        <div id="output" class="output" aria-live="polite"></div>
        <div class="footer-note">This draft is generated from your inputs. Refine as needed before release.</div>

        <hr style="margin:18px 0;border:none;border-top:1px solid #eee" />

        <div id="adminGate">
          <h2>Admin view</h2>
          <div class="help">PIN required.</div>
          <div class="row">
            <input id="pin" type="password" placeholder="Enter PIN" />
            <button class="btn alt" id="pinEnter">Unlock</button>
          </div>
        </div>

        <div id="adminPanel" class="card" style="display:none;margin-top:14px">
          <h3>Admin controls</h3>
          <label for="newPin">Set new PIN</label>
          <div class="row">
            <input id="newPin" placeholder="New PIN" />
            <button class="btn ghost" id="setPin">Update PIN</button>
          </div>

          <h3>Template and guardrails</h3>
          <label for="sysPrompt">System role template</label>
          <textarea id="sysPrompt" placeholder="Define the role, style, compliance notes."></textarea>
          <div class="btnbar">
            <button class="btn ghost" id="saveTemplate">Save template</button>
            <button class="btn ghost" id="loadTemplate">Load template</button>
            <button class="btn ghost" id="resetTemplate">Reset</button>
          </div>

          <h3>Submissions</h3>
          <div class="btnbar">
            <button class="btn ghost" id="exportAll">Export all drafts (JSON)</button>
            <button class="btn ghost" id="wipeAll">Wipe all localStorage</button>
          </div>
          <div id="adminMsg" class="help"></div>
        </div>
      </section>
    </div>
  </div>
<script defer src="scripts/rpie.js"></script>
</body>
</html>

